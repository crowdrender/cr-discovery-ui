import getQueryStringParameterByName from"../modules/QueryString.js";const amount=+getQueryStringParameterByName("amount");initialisePaymentForm(amount);function handleCardChange({error:a}){a?setErrorMessage(a.message):setErrorMessage("")}function setErrorMessage(a){const b=document.getElementById("card-errors");b.textContent=a}async function initialisePaymentForm(a){if(!a)return void alert("Amount not specified");setupPaymentSummary(a);const{clientSecret:b,publicKey:c}=await createPayment(a),d=Stripe(c),e=d.elements(),f=createCard(e);f.mount("#card-element"),f.on("change",handleCardChange);const g=document.getElementById("payment-form");g.addEventListener("submit",async a=>{var c,e;a.preventDefault(),showLoadingStatus();const g=await d.confirmCardPayment(b,{payment_method:{card:f,billing_details:{name:null===(e=null===(c=window)||void 0===c?void 0:c.user)||void 0===e?void 0:e.email}}});showResultFeedback(g)})}function setupPaymentSummary(a){const b=document.querySelector(".payment-summary"),c=document.createElement("p");c.style.textAlign="center",c.innerText=`$${formatAsCurrency(a)} USD`,b.appendChild(c)}function formatAsCurrency(a){return(a/100).toFixed(2)}async function createPayment(a){const b={method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:a})},c=await fetch("/recharge/create-recharge-payment",b).then(a=>a.json());return{clientSecret:c.client_secret,publicKey:c.public_key}}function createCard(a){const b=a.create("card",{style:{base:{color:"#32325d"}}});return b}function showResultFeedback(a){return a.error?void showFailedStatus(a.error.message):"succeeded"===a.paymentIntent.status?void showSuccessStatus():void showFailedStatus("Payment did not succeed")}function showLoadingStatus(){removeAllStatuses(),document.querySelector("#submit").classList.add("disabled"),document.querySelector("#payment-form").classList.add("status-loading")}function showFailedStatus(a){removeAllStatuses(),document.querySelector("#submit").classList.add("disabled"),document.querySelector(".status-error").classList.add("visible"),setErrorMessage(a)}function showSuccessStatus(){removeAllStatuses(),document.querySelector("#submit").classList.add("disabled"),document.querySelector(".status-success").classList.add("visible")}function removeAllStatuses(){document.querySelector(".status-success").classList.remove("visible"),document.querySelector(".status-error").classList.remove("visible"),document.querySelector("#payment-form").classList.remove("status-loading")}